KISSY.add("tb-page/taobao-home/0.4.0/mods/doctor",["ua","node","reporter","offline","./util","base","url","session"],function(e,t){function n(){this.init()}var o=t("ua"),a=t("node").all,i=a("body"),r=(t("reporter"),t("offline")),d=t("./util"),s=t("base"),c=new r,m=(t("url"),t("session"));e.extend(n,s,{init:function(){this._retina(),this._zoom(),this._webp(),this._env()},_retina:function(){d.isHighDensity()?(c.setItem("retina","1"),m.set("retina",!0)):(c.removeItem("retina"),m.set("retina",!1))},_zoom:function(){var e=this;if("windows"===o.os||"macintosh"===o.os){if(11==o.ie||"edge"==o.core)return;try{var t=this._detectZoom();t>0&&(t>1.01||.99>t)&&this._responsive(t),setInterval(function(){var t=e._detectZoom();e._responsive(t)},1e3)}catch(n){}}},_detectZoom:function(){function e(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var t=1,n=window.devicePixelRatio;return n&&1>n&&n>0?t=n:isNaN(screen.deviceXDPI)||isNaN(screen.logicalXDPI)?window.outerWidth>0&&window.innerWidth>0&&(t=window.outerWidth/window.innerWidth):t=screen.deviceXDPI/screen.logicalXDPI,e(t,1)},_responsive:function(e){e>0&&.99>e?i.addClass("tb-zoom"):i.removeClass("tb-zoom")},_webp:function(){this._supportWebp(function(e){e?(c.setItem("webp","1"),m.set("webp",!0)):c.removeItem("webp")})},_supportWebp:function(e){var t=new Image;t.onload=t.onerror=function(){e(2===t.width&&2===t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"},_env:function(){var e=a("#J_TBBucket"),t=e.attr("data-container"),n=e.val();m.set("bucket",n),t&&m.set("env",t)}}),new n}),KISSY.add("tb-page/taobao-home/0.4.0/mods/performance",["node","session","reporter","promise","json","event"],function(e,t){function n(){if(u.performance){var e={},t=u.performance.timing;if(e.load=t.loadEventEnd-t.fetchStart,e.domReady=t.domComplete-t.domInteractive,e.readyStart=t.fetchStart-t.navigationStart,e.redirect=t.redirectEnd-t.redirectStart,e.appcache=t.domainLookupStart-t.fetchStart,e.unloadEvent=t.unloadEventEnd-t.unloadEventStart,e.lookupDomain=t.domainLookupEnd-t.domainLookupStart,e.connect=t.connectEnd-t.connectStart,e.request=t.responseEnd-t.requestStart,e.initDomTree=t.domInteractive-t.responseEnd,e.loadEvent=t.loadEventEnd-t.loadEventStart,e.type=u.performance.navigation.type,e.bucket=d.get("bucket"),u.performance.memory){var n=u.performance.memory;e.memory={total:n.totalJSHeapSize,used:n.usedJSHeapSize,limit:n.jsHeapSizeLimit}}s.send({category:"DATA_Performance",msg:m.stringify(e)},"warn")}}function o(){var e=0,t=0;r(document).on("DOMContentLoaded",function(t){e=a()}),r(window).on("load",function(){t=a(),s.send({category:"DATA_Entries_Len",msg:m.stringify({type:"info",data:{ready:e,load:t,bucket:d.get("bucket")}})},"warn")})}function a(){try{return performance.getEntries().length}catch(e){}}function i(){function t(e){return r(".tbh-promo img",e).item(0).attr("src")}function n(e){var t=[];return r(".mod-first img",e).each(function(e){var n=r(e).attr("src");t.push(n)}),t}function o(e){var t=[];return r(".tbh-tanx img",e).each(function(e){t.push(r(e).attr("src"))}),t}var a=r(".J_Screen"),i=[],d=0,s="",m=null;return new c(function(c,u){r(window).on("load",function(){setTimeout(function(){i.push(t(a)),i=i.concat(n(a)),i=i.concat(o(a)),e.each(i,function(e){e="//"==e.slice(0,1)?"https:"+e:e;var t=performance.getEntriesByName(e)[0];t&&t.responseEnd>d&&(d=t.responseEnd,s=e,m=t)}),c({firstPaint:d,lastImg:s,resourceTiming:m})},2e4)})})}var r=t("node").all,d=t("session"),s=t("reporter"),c=t("promise"),m=t("json"),u=window;t("event"),u.performance&&(d.get("bucket")>1||(u.performance.getEntries&&o(),setTimeout(function(){n()},2e4),u.performance.getEntriesByName&&i().then(function(e){e&&s.send({category:"DATA_Performance_firstPaint",msg:m.stringify(e)},"warn")}).fail(function(e){})))}),KISSY.add("tb-page/taobao-home/0.4.0/mods/requestAnimationFrame",function(){var e=navigator.userAgent.toLowerCase().indexOf("taobrowser")>-1;window.requestNextAnimationFrame=function(){if(e)return function(e){setTimeout(function(){e&&e()})};var t=void 0,n=void 0,o=0,a=navigator.userAgent,i=0,r=this;return window.webkitRequestAnimationFrame&&(n=function(e){void 0===e&&(e=+new Date),r.callback(e)},t=window.webkitRequestAnimationFrame,window.webkitRequestAnimationFrame=function(e,o){r.callback=e,t(n,o)}),window.mozRequestAnimationFrame&&(i=a.indexOf("rv:"),-1!=a.indexOf("Gecko")&&(o=a.substr(i+3,3),"2.0"===o&&(window.mozRequestAnimationFrame=void 0))),window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){var n,o;window.setTimeout(function(){n=+new Date,e(n),o=+new Date,r.timeout=1e3/60-(o-n)},r.timeout)}}(),window.cancelNextRequestAnimationFrame=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}),KISSY.add("tb-page/taobao-home/0.4.0/mods/polyfill",function(e){function t(e,t){if(t=t||{bubbles:!1,cancelable:!1,detail:void 0},document.createEvent){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}}return"function"==typeof window.CustomEvent?!1:(t.prototype=window.Event&&window.Event.prototype||{},void(window.CustomEvent=t))}),KISSY.add("tb-page/taobao-home/0.4.0/mods/mod-loader",["dom","event","node","json","./monitor","reporter","datalazyload"],function(e,t){t("dom"),t("event");var n=t("node"),o=t("json"),a=t("./monitor"),i=t("reporter"),r=t("datalazyload");new a;var d=0,s=n.all,c=new r({diff:{top:50,bottom:50},autoDestroy:!0}),m=function(){this.init.apply(this,arguments)};return window.tmsInit=function(e,t,n){new m(e,t,n)},m.prototype.init=function(e,t,n){{var o=this,a=s(e);a.attr("tms-datakey")||""}if(n)return void o.loadModule(a);var i=a.attr("preload-distance");i?(i=Number(i),new r({diff:{top:i||50,bottom:i||50},autoDestroy:!0}).addCallback(a,function(){o.loadModule(a,t)})):c.addCallback(a,function(){o.loadModule(a,t)})},m.prototype.loadModule=function(e,t){var n=e,r=n.attr("tms"),s=n.attr("tms-datakey")||"";if(!t){var c=n.attr("tms-data");c&&(t=o.parse(c))}var m=++d;m=10>m?"0"+m:m;var u=+new Date;if(!n.hasClass("tbh-loaded")){if(!r)return void i.send({category:"ERROR_Loader_Crash",msg:"Loader\u52a0\u8f7d\u6a21\u5757\u65f6\uff0c\u53d1\u73b0\u6a21\u5757\u4e0d\u5b58\u5728 "+s},"warn");KISSY.use("tb-mod/"+r+"/index",function(e,d){n.addClass("tbh-loaded"),n.on("M:load",function(){var e=r+"~"+s;n.removeClass("tbh-loading"),n.all(".tb-loading").removeClass("tb-loading"),n.detach("M:load"),a.tin("\u6a21\u5757\u5e8f\u53f7: "+m+", \u6a21\u5757\u540d: "+e,u)});try{new d(n,t)}catch(c){i.send({msg:"\u6a21\u5757\u6e32\u67d3\u51fa\u9519: "+r+"~"+o.stringify(c)},"warn")}setTimeout(function(){n.hasClass("tbh-loading")&&(i.send({msg:"\u90fd\u8fc7\u4e86 8s \u4e86\uff0c\u6a21\u5757\u672a\u5b8c\u6210\u52a0\u8f7d: "+r+"~"+s},"warn"),n.removeClass("tbh-loading"),n.all(".tb-loading").removeClass("tb-loading"))},8e3)})}},m}),KISSY.add("tb-page/taobao-home/0.4.0/mods/util",function(e,t){return{isHighDensity:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3}}}),KISSY.add("tb-page/taobao-home/0.4.0/mods/monitor",["event","node","offline","reporter","session"],function(e,t){t("event");var n=t("node"),o=t("offline"),a=t("reporter"),i=t("session"),r=n.all,d=new o,s=function(){if(!s.__loaded){var e=this;s.__loaded=!0,s.startTime=+new Date,this.init(),0===i.get("bucket")&&setTimeout(function(){try{e.checkUsage()}catch(t){}},3e4),s.tin("Monitor")}};return s.tin=function(e,t){var n=+new Date,o=+new Date,i="";window.g_config&&(n=1*window.g_config.startDate),window.performance&&window.performance.timing&&window.performance.now&&(n=performance.timing.connectStart,o=performance.now()+n),t&&(i=", \u82b1\u9500\u65f6\u95f4: "+parseInt(o-t)+"ms");var r=e+" \u5f00\u59cb\u65f6\u95f4: "+parseInt(+o-s.startTime)+"ms"+i;s.startTime?a.send({msg:r}):s.startTime=n||+new Date},r(document).on("DOMContentLoaded",function(){s.tin("DOMContentLoaded")}),r(window).on("load",function(){s.tin("Window onload")}),s.prototype={init:function(){var e=this;this.checkOffline(),this.cacheUsage(),r(window).on("load",function(){e.addClickTracker(),e.scrollPV(),e.modulePVDots()}),r(document).on("private:error",function(e){try{a.send({category:"ERROR_PRIVATE_ERROR",msg:JSON.stringify(e)},"warn")}catch(t){}})},modulePVDots:function(){var e=[],t={};r("div[preload-distance]").each(function(n){var o=r(n),a=o.offset().top;t[a]=n,e.push(a)}),e=e.sort(function(e,t){return e>t?1:-1});var n,o=r(window);o.on("scroll",n=function(){if(0===e.length)return void o.detach("scroll",n);for(var i=o.scrollTop()+o.height(),d=0,s=e.length;s>d;d++){var c=e[d],m=r(t[c]);if(i>=c&&m.hasClass("tbh-loaded")){e.splice(d,1),s--;var u=m.attr("tms")+"-"+m.attr("tms-datakey")||"",l=m.attr("data-name")||"",f=m.one('a[href*="pvid"]'),w=f&&f.attr("href"),p=w&&w.match(/pvid=([^&$#]*)/);a.send({msg:"\u53d1\u9001\u771f\u5b9e\u66dd\u5149\u57cb\u70b9("+l+"): "+u,goldlog:["/tbindex.20160406.1","",{name:l,pvid:p&&p[1]||""},"H46985920"]})}}}),n()},checkOffline:function(){try{localStorage.setItem("OFFLINE_CHECKER","1")}catch(e){d.clear()}finally{d.removeItem("OFFLINE_CHECKER")}try{d.setItem("__OFFLINE_ENABLE_CHECK","1"),"1"!==d.getItem("__OFFLINE_ENABLE_CHECK")&&(a.send({category:"ERROR_Not_Support_Offline",msg:"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u672c\u5730\u50a8\u5b58\uff0c\u54ce....\u592a\u632b\u4e86"+typeof localStorage+" "+typeof localStorage.getItem},"warn"),d.clear()),d.removeItem("__OFFLINE_ENABLE_CHECK")}catch(e){}},cacheUsage:function(){var e=parseInt(d.usedByte()/1024/1024);e>=2.5&&a.send({category:"WARN_Memory_Explosion",msg:"LocalStorage \u5185\u5b58\u8d85\u8fc7 2.5M"},"warn"),e>=4&&(d.clear(),a.send({category:"ERROR_Memory_Overflow",msg:"LocalStorage \u5185\u5b58\u8d85\u8fc7 4M\uff0c\u5df2\u7ecf\u5f3a\u5236\u6e05\u7a7a\u5185\u5b58\uff01"},"warn"))},checkUsage:function(){for(var e=localStorage,t=e.length,n={},o=!1,i=0,r=0;t>r;r++){var d=e.key(r),s=e.getItem(d),c=s.length/1024;i+=c,c>100&&(n[d]=c.toFixed(4),o=!0)}o&&a.send({category:"ERROR_Memory_Status",data:{type:"info",data:{len:t,total:i,use:n}}},"warn")},scrollPV:function(){for(var t=[],n=r(window),o=[],i=700,d=350,s=0;30>s;s++)t.push(i+d*s);var c;n.on("scroll",c=function(){var i=n.scrollTop();e.each(t,function(e){i>=e&&!KISSY.inArray(e,o)&&(o.push(e),a.send({goldlog:["/tbindex.2014.10","",{top:e},"H46896546"],msg:e+"px \u89e6\u53d1\u57cb\u70b9"}))}),t.length==o.length&&n.detach("scroll",c)}),c()},addClickTracker:function(){function e(e,t,n,o){var a,i=r(e);i&&!i.attr("data-spm-click")&&(t=t?";name="+t:"",o=o||"/tbindex",n=n||"d2016",a="gostr="+o+";locaid="+n+t,i.attr("data-spm-click",a))}e(".J_Conve a[href*='zhaocaibao.alipay.com']","\u8682\u8681\u91d1\u670d\u62db\u8d22\u5b9d\u9996\u9875"),e(".J_QrFt","\u4e8c\u7ef4\u7801\u5173\u95ed\u6309\u94ae"),e(".J_PromoOpt .prev","\u9996\u7126prev\u6309\u94ae","d500"),e(".J_PromoOpt .next","\u9996\u7126next\u6309\u94ae","d600"),e(".J_TmallOpt .prev","\u5929\u732bprev\u6309\u94ae","d500"),e(".J_TmallOpt .next","\u5929\u732bnext\u6309\u94ae","d600")}},s}),KISSY.add("tb-page/taobao-home/0.4.0/index",["./mods/doctor","./mods/performance","./mods/requestAnimationFrame","./mods/polyfill","ua","dom","node","reporter","./mods/mod-loader"],function(e,t){t("./mods/doctor"),t("./mods/performance"),t("./mods/requestAnimationFrame"),t("./mods/polyfill");var n=t("ua"),o=t("dom"),a=t("node"),i=t("reporter"),r=t("./mods/mod-loader"),d=a.all,s=[];if(!(n.ie&&n.ie<8)){var c=d(".tbh-promo.J_Module");new r(c,c.attr("tms-data"),!0),d(".J_Module").each(function(e){var t=d(e),n=t.attr("tms"),o=t.attr("tms-data");return t.hasClass("tbh-promo")?void 0:t.hasClass("tb-pass")?void i.send({msg:"\u8df3\u8fc7\u6a21\u5757 "+n}):void(/promo|tmall|tanx|notice|member/.test(n)?window.requestNextAnimationFrame(function(){new r(t,o,/tanx/.test(n))}):s.push({$mod:t,data:o,force:/fixedtool|decorations|bubble|tbh-sale|fix-bottom/.test(n)}))});var m=!1,u=function(){if(!m){m=!0,d(window).detach("mousemove scroll mousedown touchstart touchmove keydown resize onload",u);for(var e;e=s.shift();)~function(e){window.requestNextAnimationFrame(function(){new r(e.$mod,e.data,e.force)})}(e)}};d(window).on("mousemove scroll mousedown touchstart touchmove keydown resize onload",u),window.requestNextAnimationFrame(function(){u()},5e3),d(window).on("resize",function(){var e=d("body"),t=o.viewportWidth();KISSY.each([990,1024,1190,1270,1365,1440],function(n){n>=t?e.addClass("s"+n):e.removeClass("s"+n)})}).fire("resize")}}),KISSY.add("tms/xtemplate",["cookie","json","xtemplate"],function(e,t){var n=t("cookie"),o=t("json"),a=t("xtemplate"),i={cookies:n,JSON:o,Math:Math,RegExp:RegExp,"typeof":function(e){return null===e?"null":void 0===e?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e},url:function(){var t={};return e.each("href,protocol,host,hostname,port,pathname,search,hash".split(","),function(e){t[e]=location[e]}),t.query=e.unparam(location.search.slice(1)),t}(),now:+new Date},r=["assets","tms","redirect"],d=function(){};e.each(r,function(e){a.addCommand(e,d)});var s=a.prototype.render;return a.prototype.render=function(){return arguments[0]=new a.Scope(arguments[0],{$env:i}),s.apply(this,arguments)},a});